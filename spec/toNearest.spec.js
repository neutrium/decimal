var Decimal = require('../dist/Decimal').Decimal;

function test(cases)
{
    for(var i = 0; i < cases.length; i++)
    {
        var testCase = cases[i];

        it('should toNearest ' + testCase[1] + ' equal ' + testCase[0], function() {

            if (testCase[3]) Decimal.precision = testCase[3];

            expect(new Decimal(testCase[1]).toNearest(testCase[2], testCase[4]).valueOf()).toEqual(testCase[0]);
        });
    }
    return true;
}

describe("Neutrium Decimal toNearest Tests", function() {

    beforeEach(function() {
        Decimal.config({
            precision: 20,
            rounding: 4,
            toExpNeg: -9e15,
            toExpPos: 9e15,
            minE: -9e15,
            maxE: 9e15
        });
    });


    describe("base tests", function() {

        var cases = [
            ['Infinity', Infinity],
            ['-Infinity', -Infinity],
            ['NaN', NaN],
            ['NaN', NaN, NaN],
            ['NaN', NaN, Infinity],
            ['NaN', NaN, -Infinity],
            ['NaN', NaN, 0],
            ['NaN', NaN, -0],

            ['Infinity', '9.999e+9000000000000000', '1e+9000000000000001'],
            ['Infinity', '9.999e+9000000000000000', '-1e+9000000000000001'],
            ['-Infinity', '-9.999e+9000000000000000', '1e+9000000000000001'],
            ['-Infinity', '-9.999e+9000000000000000', '-1e+9000000000000001'],
            ['9.999e+9000000000000000', '9.999e+9000000000000000'],
            ['-9.999e+9000000000000000', '-9.999e+9000000000000000'],

            ['NaN', 123.456, NaN],
            ['Infinity', 123.456, Infinity],
            ['Infinity', 123.456, -Infinity],
            ['0', 123.456, 0],
            ['0', 123.456, '-0'],

            ['NaN', -123.456, NaN],
            ['-Infinity', -123.456, Infinity],
            ['-Infinity', -123.456, -Infinity],
            ['-0', -123.456, '-0'],

            ['0', 0, 0],
            ['Infinity', 0, Infinity],
            ['Infinity', 0, -Infinity],
            ['-Infinity', -0, Infinity],
            ['-Infinity', -0, -Infinity],

            ['0', 1, -3],
            ['-0', -1, -3],
            ['3', 1.5, -3, 20, 0],
            ['-0', -1.5, -3, 20, 1],
            ['-3', -1.5, -3, 20, 2],

            ['123', 123.456],
            ['123', 123.456, 1],
            ['123.5', 123.456, 0.1],
            ['123.46', 123.456, 0.01],
            ['123.456', 123.456, 0.001],

            ['123', 123.456, -1],
            ['123.5', 123.456, -0.1],
            ['123.46', 123.456, -0.01],
            ['123.456', 123.456, -0.001],

            ['124', 123.456, '-2'],
            ['123.4', 123.456, '-0.2'],
            ['123.46', 123.456, '-0.02'],
            ['123.456', 123.456, '-0.002'],

            ['83105511540', '83105511539.5', 1, 11, 4],
            ['83105511539', '83105511539.499999999999999999999999999999', 1, 11, 4],
            ['83105511539', '83105511539.5', '1', 11, 5],
           ['83105511540', '83105511539.5000000000000000000001', 1, 11, 5],

            ['83105511540', '83105511539.5', new Decimal(1), 3, 4],
            ['83105511539', '83105511539.499999999999999999999999999999', 1, 3, 4],
            ['83105511539', '83105511539.5', new Decimal('1'), 3, 5],
            ['83105511540', '83105511539.5000000000000000000001', 1, 3, 5],

            ['83105511540', '83105511539.5', Decimal.ONE, 30, 4],
            ['83105511539', '83105511539.499999999999999999999999999999', 1, 30, 4],
            ['83105511539', '83105511539.5', 1, 30, 5],
            ['83105511540', '83105511539.5000000000000000000001', 1, 30, 5],

            ['83105511540', '83105511539.5', -1, 11, 4],
            ['83105511539', '83105511539.499999999999999999999999999999', -1, 11, 4],
            ['83105511539', '83105511539.5', '-1', 11, 5],
            ['83105511540', '83105511539.5000000000000000000001', -1, 11, 5],

            ['83105511540', '83105511539.5', new Decimal(-1), 3, 4],
            ['83105511539', '83105511539.499999999999999999999999999999', 1, 3, 4],
            ['83105511539', '83105511539.5', new Decimal('-1'), 3, 5],
            ['83105511540', '83105511539.5000000000000000000001', -1, 3, 5],

            ['83105511540', '83105511539.5', 1, 30, 0],
            ['83105511539', '83105511539.5', 1, 30, 1],
            ['83105511540', '83105511539.5', 1, 30, 2],
            ['83105511539', '83105511539.5', 1, 30, 3],
            ['83105511540', '83105511539.5', 1, 30, 4],
            ['83105511539', '83105511539.5', 1, 30, 5],
            ['83105511540', '83105511539.5', 1, 30, 6],
            ['83105511540', '83105511539.5', 1, 30, 7],
            ['83105511539', '83105511539.5', 1, 30, 8],
            ['83105511539', '83105511539.499999999999999999999999999999', void 0, 30, 0],
            ['83105511539', '83105511539.499999999999999999999999999999', 1, 30, 1],
            ['83105511539', '83105511539.499999999999999999999999999999', void 0, 30, 2],
            ['83105511539', '83105511539.499999999999999999999999999999', 1, 30, 3],
            ['83105511539', '83105511539.499999999999999999999999999999', void 0, 30, 4],
            ['83105511539', '83105511539.499999999999999999999999999999', 1, 30, 5],
            ['83105511539', '83105511539.499999999999999999999999999999', void 0, 30, 6],
            ['83105511539', '83105511539.499999999999999999999999999999', 1, 30, 7],
            ['83105511539', '83105511539.499999999999999999999999999999', void 0, 30, 8],
            ['83105511540', '83105511539.5000000000000000000001', void 0, 30, 0],
            ['83105511540', '83105511539.5000000000000000000001', 1, 30, 1],
            ['83105511540', '83105511539.5000000000000000000001', void 0, 30, 2],
            ['83105511540', '83105511539.5000000000000000000001', 1, 30, 3],
            ['83105511540', '83105511539.5000000000000000000001', void 0, 30, 4],
            ['83105511540', '83105511539.5000000000000000000001', 1, 30, 5],
            ['83105511540', '83105511539.5000000000000000000001', void 0, 30, 6],
            ['83105511540', '83105511539.5000000000000000000001', 1, 30, 7],
            ['83105511540', '83105511539.5000000000000000000001', void 0, 30, 8]
        ]

        test(cases);
    });

    describe("rounding = 0", function() {
        beforeEach(function() {
            Decimal.rounding = 0;
        });

        var cases = [
            ['83105511540', '83105511539.5', void 0, 11]
        ];

        test(cases);
    });

    describe("rounding = 1", function() {
        beforeEach(function() {
            Decimal.rounding = 1;
        });

        var cases = [
            ['83105511539', '83105511539.5', void 0, 11],

            ['3847560', '3847561.00000749', 10, 11, 0],
            ['42840000000000000', '42835000000000001', '1e+13', 2, 0],
            ['42840000000000000', '42835000000000001', '1e+13', 2, 1],
            ['42840000000000000', '42835000000000000.0002', '1e+13', 200, 0],
            ['42840000000000000', '42835000000000000.0002', '1e+13', 200, 1]
        ];

        test(cases);
    });

    describe("Minus zero tests", function() {

        function isMinusZero(n)
        {
            return n.isZero() && n.isNeg();
        }

        var cases = [
            !isMinusZero(new Decimal(0).toNearest(0)),
            isMinusZero(new Decimal(-1).toNearest(0)),
            isMinusZero(new Decimal(-0).toNearest(0)),
            !isMinusZero(new Decimal(1).toNearest(0)),
            !isMinusZero(new Decimal(1).toNearest(-0)),
            !isMinusZero(new Decimal(1).toNearest(-3)),
            isMinusZero(new Decimal(-1).toNearest(-3))
        ];

        for(var i = 0; i < cases.length; i++)
        {
            var testCase = cases[i];

            it('should be true', function() {
                expect(testCase).toEqual(true);
            });
        }
    });
});
